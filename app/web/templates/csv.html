{% extends "base.html" %}

{% block content %}
  <section class="panel grid">
    <form class="import-form" method="post" action="/import.csv" enctype="multipart/form-data">
      <label for="source_platform">Source CSV Platform</label>
      <div class="select-wrap">
        <select id="source_platform" name="source_platform" required>
          <option value="shopify" {% if csv_form.source_platform == "shopify" %}selected{% endif %}>Shopify</option>
          <option value="bigcommerce" {% if csv_form.source_platform == "bigcommerce" %}selected{% endif %}>BigCommerce</option>
          <option value="wix" {% if csv_form.source_platform == "wix" %}selected{% endif %}>Wix</option>
          <option value="squarespace" {% if csv_form.source_platform == "squarespace" %}selected{% endif %}>Squarespace</option>
          <option value="woocommerce" {% if csv_form.source_platform == "woocommerce" %}selected{% endif %}>WooCommerce</option>
        </select>
      </div>

      <div
        id="source-weight-fields"
        class="conditional-fields{% if csv_form.source_platform not in source_weight_unit_required_platforms %} is-hidden{% endif %}"
        aria-hidden="{% if csv_form.source_platform in source_weight_unit_required_platforms %}false{% else %}true{% endif %}"
      >
        <label for="source_weight_unit">Source Weight Unit</label>
        <div class="select-wrap">
          <select
            id="source_weight_unit"
            name="source_weight_unit"
            {% if csv_form.source_platform not in source_weight_unit_required_platforms %}disabled{% endif %}
          >
            {% for unit in source_weight_unit_allowlist %}
            <option value="{{ unit }}" {% if csv_form.source_weight_unit == unit %}selected{% endif %}>{{ unit|upper }}</option>
            {% endfor %}
          </select>
        </div>
      </div>

      <label for="source_csv_file">CSV File</label>
      <input id="source_csv_file" name="file" type="file" accept=".csv,text/csv" required />

      <button type="submit">Import CSV</button>
    </form>

    <aside class="info">
      <h2>CSV Import</h2>
      <p class="api-note">API endpoint: <code>POST /api/v1/import/csv</code></p>
      <p class="api-note">Upload limit: <code>5 MB</code></p>
    </aside>
  </section>

  {% if editor_product_payload %}
  {% include "_product_editor.html" %}

  <section class="panel grid">
    <form class="import-form" method="post" action="/export-from-product.csv">
      <input type="hidden" name="product_json_b64" value="{{ preview_product_json_b64 }}" />

      <label for="preview_target_platform">Target Platform</label>
      <div class="select-wrap">
        <select id="preview_target_platform" name="target_platform" required>
          <option value="shopify">Shopify</option>
          <option value="bigcommerce">BigCommerce</option>
          <option value="wix">Wix</option>
          <option value="squarespace">Squarespace</option>
          <option value="woocommerce">WooCommerce</option>
        </select>
      </div>

      <label for="preview_weight_unit">Weight Unit</label>
      <div class="select-wrap">
        <select id="preview_weight_unit" name="weight_unit" required></select>
      </div>

      <div id="preview-bigcommerce-fields" class="conditional-fields is-hidden" aria-hidden="true">
        <label for="preview_bigcommerce_csv_format">BigCommerce CSV Format</label>
        <div class="select-wrap">
          <select id="preview_bigcommerce_csv_format" name="bigcommerce_csv_format" disabled>
            <option value="modern">Modern</option>
            <option value="legacy">Legacy</option>
          </select>
        </div>
      </div>

      <div id="preview-squarespace-fields" class="conditional-fields is-hidden" aria-hidden="true">
        <label for="preview_squarespace_product_page">Squarespace Product Page</label>
        <input id="preview_squarespace_product_page" name="squarespace_product_page" type="text" placeholder="shop" disabled />
        <label for="preview_squarespace_product_url">Squarespace Product URL</label>
        <input id="preview_squarespace_product_url" name="squarespace_product_url" type="text" placeholder="lemons" disabled />
      </div>

      <button type="submit">Export Preview as CSV</button>
    </form>

    <aside class="info">
      <h2>Conversion</h2>
      <p class="api-note">API endpoint: <code>POST /api/v1/export/from-product.csv</code></p>
    </aside>
  </section>
  {% endif %}

  {% if csv_error %}
  <section class="panel error">
    <h2>CSV Import Error</h2>
    <p>{{ csv_error }}</p>
  </section>
  {% endif %}
{% endblock %}
