<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{{ brand.app_name }}</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;700&family=IBM+Plex+Sans:wght@400;500;600&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="{{ url_for('static', path='/styles.css') }}" />
    <style>
      :root {
        --brand-primary: {{ brand.brand_primary }};
        --brand-secondary: {{ brand.brand_secondary }};
        --brand-ink: {{ brand.brand_ink }};
      }
    </style>
  </head>
  <body>
    <main class="shell">
      <section class="panel hero">
        <p class="eyebrow">CSV Export Workflow</p>
        <h1>{{ brand.app_name }}</h1>
        <p>{{ brand.app_tagline }}</p>
      </section>

      <section class="panel grid">
        <form class="import-form" method="post" action="/export.csv">
          {% set show_squarespace_fields = form.target_platform == "squarespace" %}

          <label for="product_url">Product URL</label>
          <input
            id="product_url"
            name="product_url"
            type="url"
            placeholder="https://store.com/products/example"
            value="{{ form.product_url }}"
            required
          />

          <label for="target_platform">Target Platform</label>
          <div class="select-wrap">
            <select id="target_platform" name="target_platform" required>
              <option value="shopify" {% if form.target_platform == "shopify" %}selected{% endif %}>Shopify</option>
              <option value="squarespace" {% if form.target_platform == "squarespace" %}selected{% endif %}>Squarespace</option>
              <option value="woocommerce" {% if form.target_platform == "woocommerce" %}selected{% endif %}>WooCommerce</option>
            </select>
          </div>

          <div
            id="squarespace-fields"
            class="conditional-fields{% if not show_squarespace_fields %} is-hidden{% endif %}"
            aria-hidden="{% if show_squarespace_fields %}false{% else %}true{% endif %}"
          >
            <label for="squarespace_product_page">Squarespace Product Page</label>
            <input
              id="squarespace_product_page"
              name="squarespace_product_page"
              type="text"
              placeholder="shop"
              value="{{ form.squarespace_product_page }}"
              {% if not show_squarespace_fields %}disabled{% endif %}
            />

            <label for="squarespace_product_url">Squarespace Product URL</label>
            <input
              id="squarespace_product_url"
              name="squarespace_product_url"
              type="text"
              placeholder="lemons"
              value="{{ form.squarespace_product_url }}"
              {% if not show_squarespace_fields %}disabled{% endif %}
            />
          </div>

          <button type="submit">Export CSV</button>
        </form>

        <aside class="info">
          <h2>Try URLs</h2>
          <ul>
            {% for example in examples %}
            <li><code>{{ example }}</code></li>
            {% endfor %}
          </ul>
          <p class="api-note">API endpoints: <code>POST /api/v1/export/{platform}.csv</code></p>
        </aside>
      </section>

      {% if error %}
      <section class="panel error">
        <h2>Export Error</h2>
        <p>{{ error }}</p>
      </section>
      {% endif %}
    </main>
    <script>
      (() => {
        const targetPlatform = document.getElementById("target_platform");
        const squarespaceFields = document.getElementById("squarespace-fields");
        if (!targetPlatform || !squarespaceFields) {
          return;
        }

        const squarespaceInputs = squarespaceFields.querySelectorAll("input");

        const syncSquarespaceFields = () => {
          const showSquarespaceFields = targetPlatform.value === "squarespace";
          squarespaceFields.classList.toggle("is-hidden", !showSquarespaceFields);
          squarespaceFields.setAttribute("aria-hidden", showSquarespaceFields ? "false" : "true");
          squarespaceInputs.forEach((input) => {
            input.disabled = !showSquarespaceFields;
          });
        };

        targetPlatform.addEventListener("change", syncSquarespaceFields);
        syncSquarespaceFields();
      })();
    </script>
  </body>
</html>
