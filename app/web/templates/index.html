{% extends "base.html" %}

{% block content %}
      <section class="panel grid">
        <form class="import-form" method="post" action="/export.csv">
          {% set show_squarespace_fields = form.target_platform == "squarespace" %}

          <label for="product_url">Product URL</label>
          <input
            id="product_url"
            name="product_url"
            type="url"
            placeholder="https://store.com/products/example"
            value="{{ form.product_url }}"
            required
          />

          <label for="target_platform">Target Platform</label>
          <div class="select-wrap">
            <select id="target_platform" name="target_platform" required>
              <option value="shopify" {% if form.target_platform == "shopify" %}selected{% endif %}>Shopify</option>
              <option value="bigcommerce" {% if form.target_platform == "bigcommerce" %}selected{% endif %}>BigCommerce</option>
              <option value="wix" {% if form.target_platform == "wix" %}selected{% endif %}>Wix</option>
              <option value="squarespace" {% if form.target_platform == "squarespace" %}selected{% endif %}>Squarespace</option>
              <option value="woocommerce" {% if form.target_platform == "woocommerce" %}selected{% endif %}>WooCommerce</option>
            </select>
          </div>

          {% set selected_weight_unit = form.weight_unit if form.weight_unit else weight_unit_defaults[form.target_platform] %}
          <label for="weight_unit">Weight Unit</label>
          <div class="select-wrap">
            <select id="weight_unit" name="weight_unit" required>
              {% for unit in weight_unit_allowlist[form.target_platform] %}
              <option value="{{ unit }}" {% if selected_weight_unit == unit %}selected{% endif %}>{{ unit|upper }}</option>
              {% endfor %}
            </select>
          </div>

          <div
            id="bigcommerce-fields"
            class="conditional-fields{% if form.target_platform != "bigcommerce" %} is-hidden{% endif %}"
            aria-hidden="{% if form.target_platform == "bigcommerce" %}false{% else %}true{% endif %}"
          >
            <label for="bigcommerce_csv_format">BigCommerce CSV Format</label>
            <div class="select-wrap">
              <select
                id="bigcommerce_csv_format"
                name="bigcommerce_csv_format"
                {% if form.target_platform != "bigcommerce" %}disabled{% endif %}
              >
                <option value="modern" {% if form.bigcommerce_csv_format == "modern" %}selected{% endif %}>Modern</option>
                <option value="legacy" {% if form.bigcommerce_csv_format == "legacy" %}selected{% endif %}>Legacy</option>
              </select>
            </div>
          </div>

          <div
            id="squarespace-fields"
            class="conditional-fields{% if not show_squarespace_fields %} is-hidden{% endif %}"
            aria-hidden="{% if show_squarespace_fields %}false{% else %}true{% endif %}"
          >
            <label for="squarespace_product_page">Squarespace Product Page</label>
            <input
              id="squarespace_product_page"
              name="squarespace_product_page"
              type="text"
              placeholder="shop"
              value="{{ form.squarespace_product_page }}"
              {% if not show_squarespace_fields %}disabled{% endif %}
            />

            <label for="squarespace_product_url">Squarespace Product URL</label>
            <input
              id="squarespace_product_url"
              name="squarespace_product_url"
              type="text"
              placeholder="lemons"
              value="{{ form.squarespace_product_url }}"
              {% if not show_squarespace_fields %}disabled{% endif %}
            />
          </div>

          <button type="submit">Export CSV</button>
        </form>

        <aside class="info">
          <h2>Try URLs</h2>
          <ul>
            {% for example in examples %}
            <li><code>{{ example }}</code></li>
            {% endfor %}
          </ul>
          <p class="api-note">API endpoints: <code>POST /api/v1/export/{platform}.csv</code></p>
        </aside>
      </section>

      {% if error %}
      <section class="panel error">
        <h2>Export Error</h2>
        <p>{{ error }}</p>
      </section>
      {% endif %}
{% endblock %}
