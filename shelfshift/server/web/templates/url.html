{% extends "base.html" %}

{% block content %}
  <section class="panel grid">
    <form class="import-form" method="post" action="/import.url" data-export-form>
      <label>Product page URLs</label>
      <div class="url-input-list" data-url-input-list>
        {% for url in form.product_urls %}
        <div class="url-input-row" data-url-row>
          <input
            name="product_urls"
            type="url"
            placeholder="https://store.com/products/example"
            value="{{ url }}"
          />
          <button type="button" class="url-remove-btn" data-action="remove-url" aria-label="Remove URL">&times;</button>
        </div>
        {% endfor %}
      </div>
      <button type="button" class="url-add-btn" data-action="add-url">+ Add URL</button>

      <button type="submit">Import Products</button>
    </form>

    <aside class="info">
      <h2>Supported Platforms</h2>
      <p>Paste any <strong>product page URL</strong> from these stores:</p>
      <div class="platform-tags">
        <span class="platform-tag">Shopify</span>
        <span class="platform-tag">Amazon</span>
        <span class="platform-tag">AliExpress</span>
        <span class="platform-tag">WooCommerce</span>
        <span class="platform-tag">Squarespace</span>
      </div>
      <p class="api-note">The URL must point to a single product page &mdash; collection or category pages are not supported.</p>
      <p class="api-note">API endpoint: <code>POST /api/v1/import</code></p>
    </aside>
  </section>

  {% if editor_products_payload %}
  {% include "_product_editor_batch.html" %}

  {% set export_submit_label = "Export All as CSV" %}
  {% set export_info_heading = "Batch Export" %}
  {% set export_info_extra = '<p class="api-note">' ~ (editor_products_payload | length) ~ ' product' ~ ('s' if editor_products_payload | length != 1 else '') ~ ' ready for export</p>' %}
  {% include "_export_form.html" %}
  {% elif editor_product_payload %}
  {% include "_product_editor.html" %}

  {% set export_submit_label = "Export Preview as CSV" %}
  {% set export_info_heading = "Export" %}
  {% set export_info_extra = "" %}
  {% include "_export_form.html" %}
  {% endif %}

  {% if url_import_errors %}
  <section class="panel error" role="alert">
    <h2>
      <svg class="error-icon" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true"><path fill-rule="evenodd" d="M8.485 2.495c.673-1.167 2.357-1.167 3.03 0l6.28 10.875c.673 1.167-.168 2.625-1.516 2.625H3.72c-1.347 0-2.189-1.458-1.515-2.625L8.485 2.495zM10 5a.75.75 0 01.75.75v3.5a.75.75 0 01-1.5 0v-3.5A.75.75 0 0110 5zm0 9a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd"/></svg>
      Some URLs Failed
    </h2>
    <ul class="import-error-list">
      {% for err in url_import_errors %}
      <li><code>{{ err.url }}</code> &mdash; {{ err.detail }}</li>
      {% endfor %}
    </ul>
  </section>
  {% endif %}

  {% if error %}
  <section class="panel error" role="alert">
    <h2>
      <svg class="error-icon" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true"><path fill-rule="evenodd" d="M8.485 2.495c.673-1.167 2.357-1.167 3.03 0l6.28 10.875c.673 1.167-.168 2.625-1.516 2.625H3.72c-1.347 0-2.189-1.458-1.515-2.625L8.485 2.495zM10 5a.75.75 0 01.75.75v3.5a.75.75 0 01-1.5 0v-3.5A.75.75 0 0110 5zm0 9a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd"/></svg>
      {{ error_title }}
    </h2>
    <p>{{ error }}</p>
  </section>
  {% endif %}
{% endblock %}
